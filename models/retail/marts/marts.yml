version: 2

models:
  - name: monthly_gross_revenue
    columns:
      - name: ORDER_MONTH
        tests:
          - not_null
      - name: GROSS_REVENUE
        tests:
          - not_null
          - greater_than


metrics:
  - name:  total_revenue
    label: Total Revenue
    tags: 
      - retail
    model: ref('order_details')
    description: "The revenue made from selling goods and services"

    calculation_method: sum
    expression: gross_revenue

    timestamp: order_date
    time_grains: [day, week, month, quarter, year]

    dimensions:
      - market_segment
      - nation
      - region
      - customer_name

  - name:  num_customers
    label: Number of Customers
    tags: 
      - retail
    model: ref('order_details')
    description: "The number of customers"

    calculation_method: count_distinct
    expression: customer_key

    timestamp: order_date
    time_grains: [day, week, month, quarter, year]

    dimensions:
      - market_segment
      - nation
      - region
      - customer_name


exposures:
  - name: monthly_gross_revenue_dashboard
    label: "Revenue Dashboard! ðŸ“ˆ"
    description: Monthly revenue - simple extract of month with a simple sum of revenue.

    type: dashboard 
    url: https://app.hex.tech/dbtlabs_partner/app/4709906b-f581-4c2d-bed9-1ab8a046a9d9/latest
    
    owner:
      name: Randy Pitcher âš¡
      email: randy@work.com

    depends_on:
      - ref('monthly_gross_revenue')